# 题目 01- 一条 SQL 语句在 MySQL 中是如何执行的？

1. **连接到数据库**

    首先通过连接器，连接到数据库，连接器在超过配置的空闲等待时间后会自动断开，默认配置是8小时

2. **查询缓存（MySQL8.0之后版本去除）**

    mysql 在开启缓存功能后，会将之前执行过的语句以及结果以 key-value 的形式缓存在内存中，key 是语句hash之后的值， value 是查询结果。

    如果查询语句在缓存中，则直接将结果返回给客户端，如果查询语句不在缓存中，则进行后面的执行步骤，执行后的结果会保存入缓存中。

3. **分析sql语句**

    1. 词法分析：将SQL分解为字符串，识别出字符串中的关键字、表名、列名等
    2. 语法分析：按照MySQL中的语法规则，将SQL生成解析树
    3. 预处理器：检查解析树是否合法，表名、列名等是否存在，检查用户是否有表的操作权限，生成一个新的解析树，调用执行模块
   
4. **优化sql语句**
    
    根据解析树生成不同的执行计划，选择最优的执行计划（io_cost 和 cpu_cost 总和开销最小）

5. **执行sql语句**
    
    1. 判断是否有执行权限，如果没有权限，返回没有权限的报错
    2. 如果有权限，执行器根据表使用的存储引擎，调用存储引擎的接口查询数据，返回结果给客户端。

# 题目 02- 请解释一下你理解的事务是什么？

   事务是指逻辑上的一组操作，事务中的操作要么全部发生，要么全部不发生。

   事务有四大特征 ACID  

   A（Atomicity）原子性: 整个事务中的操作，要么全部完成，要不全部不完成。
   如果执行过程中发生错误，事务会回滚到开始前的状态，就像没有执行过一样。
   
   C（Consistency）一致性：一个事务在执行前后，数据库都必须处于正确的状态，满足完整性约束。用锁来保证事务的一致性。
   
   I（Isolation）隔离性：多个事务并发执行时，一个事务的执行不应该影响其他事务的执行。事务的隔离性由隔离级别进行保障。
   
   D（Durability）持久性：已被提交的事务对数据库的修改应该永久保存在数据库中。
   
   事务并发问题：

   1. 脏读：一个事务读到了另一个事务未提交的数据
   2. 不可重复读：一个事务读到了另一个事务已经提交的数据，导致同一事务中两次读取到的数据不一致
   3. 幻读：一个事务读到了另一个事务已经插入的数据，导致同一事务，两次读取到的记录条数不一致

   事务隔离级别：
   
   数据库规范定义了4种隔离级别，用来描述两个事务并发的所有情况。
   
   1. read uncommitted: 读未提交，一个事务读到另一个事务没有提交的数据
      问题：脏读、不可重复读、幻读

   2. read committed: 读已提交，一个事务读到另一个事务已经提交的数据
      问题：不可重复读、幻读

   3. repeatable read: 可重复读，在一个事务中读到的数据始终保持一致，无论另一个事务是否提交
      问题：幻读

   4. serializable: 串行化，同时只能执行一个事务，相当于事务中的单线程。
      问题：三个问题都没有

   mysql默认隔离级别是 repeatable read
   oracle默认隔离级别是 read commited